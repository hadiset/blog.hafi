---
import BaseLayout from "./BaseLayout.astro";
import { formatDate, calculateReadTimes } from "../utils/helpers";
import { Image } from "astro:assets";

export interface Props {
  frontmatter: {
    title: string;
    description: string;
    author: string;
    publish_date: Date;
    image?: string;
    imageAlt?: string;
    category?: string;
    tags?: string[];
  };
  content?: string;
}

const { frontmatter, content } = Astro.props;
const readTime = content ? calculateReadTimes(content) : 0;
---

<BaseLayout
  pageTitle={frontmatter.title}
  description={frontmatter.description}
  image={frontmatter.image}
  articleDate={frontmatter.publish_date.toISOString()}
  author={frontmatter.author}
>
  <article class="max-w-4xl mx-auto px-6 py-12">
    <!-- Article Header -->
    <header class="mb-12">
      <!-- Category Badge -->
      <div class="mb-6">
        <span
          class="inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-sm font-medium"
        >
          {frontmatter.category}
        </span>
      </div>

      <!-- Title -->
      <h1
        class="text-4xl md:text-5xl font-bold leading-tight mb-6 text-gray-900 dark:text-white"
      >
        {frontmatter.title}
      </h1>

      <!-- Subtitle/Description -->
      <p
        class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 leading-relaxed mb-8 font-light"
      >
        {frontmatter.description}
      </p>

      <!-- Meta Info -->
      <div
        class="flex items-center text-gray-500 dark:text-gray-400 text-sm space-x-4 mb-8"
      >
        <span class="font-medium text-gray-700 dark:text-gray-300">
          {frontmatter.author}
        </span>
        <span>•</span>
        <time datetime={frontmatter.publish_date.toISOString()}>
          {formatDate(frontmatter.publish_date)}
        </time>
        <span>•</span>
        <span>{readTime} min read</span>
      </div>

      <!-- Featured Image -->
      {
        frontmatter.image && (
          <div class="mb-12">
            <Image
              src={frontmatter.image}
              alt={frontmatter.imageAlt || frontmatter.title}
              width={800}
              height={400}
              class="w-full h-auto rounded-lg shadow-lg"
              loading="eager"
            />
          </div>
        )
      }
    </header>

    <!-- Article Content -->
    <div
      class="prose prose-lg dark:prose-invert max-w-none
            prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-white
            prose-p:text-gray-700 dark:prose-p:text-gray-300 prose-p:leading-relaxed 
            prose-li:text-gray-700 dark:prose-li:text-gray-300
            prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline
            prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:border prose-pre:border-gray-700
            prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:pl-6
            prose-img:rounded-lg prose-img:shadow-md"
    >
      <slot />
    </div>

    <!-- Tags -->
    {
      frontmatter.tags && frontmatter.tags.length > 0 && (
        <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
          <div class="flex flex-wrap gap-2">
            {frontmatter.tags.map((tag) => (
              <a
                href={`/tag/${tag}`}
                class="inline-block bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 
                     px-3 py-1 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-700 
                     transition-colors duration-200"
              >
                #{tag}
              </a>
            ))}
          </div>
        </footer>
      )
    }
  </article>
</BaseLayout>

<style>
  @reference "tailwindcss";
  /* Custom prose styles for better Medium-like appearance */
  .prose {
    @apply text-gray-800 dark:text-gray-200;
  }

  .prose h2 {
    @apply text-2xl mt-12 mb-6;
  }

  .prose h3 {
    @apply text-xl mt-10 mb-4;
  }

  .prose p {
    @apply mb-6 text-lg leading-8;
  }

  .prose ul,
  .prose ol {
    @apply my-6;
  }

  .prose li {
    @apply mb-2;
  }
</style>
